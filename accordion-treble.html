<imports >
    <link rel="import" href="../polymer/polymer.html">
    <link rel="import" href="../animation-behaviors/scale-up-behavior.html">
    <link rel="import" href="./accordion-buttons-behavior.html">
    <link rel="import" href="../ac-instrument-behaviors/instrument-buttons-behavior.html">
    <link rel="import" href="../local-dom/local-dom.html" async>
    <link rel="import" href="./accordion-button.html" async>
    <link rel="import" href="../ac-synthesizer/ac-synthesizer.html">
    <link rel="import" href="../iron-localstorage/iron-localstorage.html">
</imports>
<!--

Shows drop down menu (works on chrome)

### Usage
The list displayed in the drop down menu can be set as an attribute.

    <drop-menu list-items='["first" ,"second"]'></drop-menu>

For an overlayed drop menu:

    <drop-menu overlay-menu list-items='["first" ,"second"]'></drop-menu>

### Styling
 Custom property | Description | Default
----------------|-------------|----------
`--item-background-color` | List item backround color | `#f1ecef`
`--item-color` | List item color used for fonts | `#302f31`
`--button-close-color` | Icon button hover color | `4775D1`
`--button-background-color` | Drop menu's background color | `white`
`--button-close-color` | Icon button hover color | `4775D1`
`--icon-button` | Mixin applied the icon button | `{}`

@demo demo/drop-menu-demo.html
-->
<dom-module id="accordion-treble">
    <template>
        <style>
            :host {}
            local-dom {
                height: 100vh;
                @apply(--layout-center);
                @apply(--layout-justified);
            }
            .col1 {
                height: 82vh;
                /*@apply(--layout-vertical);*/
                @apply(--layout-justified);
            }
            .col2 {
                height: 92vh;
                padding: 0;
                /*margin-left: -0.3vh;
                margin-right: -0.3vh;*/
                /*@apply(--layout-vertical);*/
                @apply(--layout-justified);
            }
            [mobile] #col2 {
                padding: 0.8vw;
            }
            [tablet] #col2 {
                padding: 0.6vw;
            }
            .vertical {
                @apply(--layout-vertical);
            }
            .reversedVertical {
                @apply(--layout-vertical-reverse);
            }
            .reversedHorizontal {
                @apply(--layout-horizontal-reverse);
            }
            .horizontal {
                @apply(--layout-horizontal);
            }
        </style>
        <!-- local DOM -->
        <ac-synthesizer instrument-url="/data/accordion_synth/treble"></ac-synthesizer>
        <local-dom class$="{{_computeRotation(rotation)}}" mobile="{{mobile}}" tablet="{{tablet}}" laptop="{{laptop}}">
            <div class$="col1 {{_computeColRotation(rotation)}}">
                <accordion-button button id21 close-index="[[closeIndex.21]]" open-index="[[openIndex.21]]" button-type="treble"></accordion-button>
                <accordion-button button id22 close-index="[[closeIndex.22]]" open-index="[[openIndex.22]]" button-type="treble"></accordion-button>
                <accordion-button button id23 close-index="[[closeIndex.23]]" open-index="[[openIndex.23]]" button-type="treble"></accordion-button>
                <accordion-button button id24 close-index="[[closeIndex.24]]" open-index="[[openIndex.24]]" button-type="treble"></accordion-button>
                <accordion-button button id25 close-index="[[closeIndex.25]]" open-index="[[openIndex.25]]" button-type="treble"></accordion-button>
                <accordion-button button id26 close-index="[[closeIndex.26]]" open-index="[[openIndex.26]]" button-type="treble"></accordion-button>
                <accordion-button button id27 close-index="[[closeIndex.27]]" open-index="[[openIndex.27]]" button-type="treble"></accordion-button>
                <accordion-button button id28 close-index="[[closeIndex.28]]" open-index="[[openIndex.28]]" button-type="treble"></accordion-button>
                <accordion-button button id29 close-index="[[closeIndex.29]]" open-index="[[openIndex.29]]" button-type="treble"></accordion-button>
                <accordion-button button id30 close-index="[[closeIndex.30]]" open-index="[[openIndex.30]]" button-type="treble"></accordion-button>
            </div>
            <div class$="col2 {{_computeColRotation(rotation)}}">
                <accordion-button button id10 close-index="{{closeIndex.10}}" open-index="{{openIndex.10}}" button-type="treble"></accordion-button>
                <accordion-button button id11 close-index="{{closeIndex.11}}" open-index="{{openIndex.11}}" button-type="treble"></accordion-button>
                <accordion-button button id12 close-index="{{closeIndex.12}}" open-index="{{openIndex.12}}" button-type="treble"></accordion-button>
                <accordion-button button id13 close-index="{{closeIndex.13}}" open-index="{{openIndex.13}}" button-type="treble"></accordion-button>
                <accordion-button button id14 close-index="{{closeIndex.14}}" open-index="{{openIndex.14}}" button-type="treble"></accordion-button>
                <accordion-button button id15 close-index="{{closeIndex.15}}" open-index="{{openIndex.15}}" button-type="treble"></accordion-button>
                <accordion-button button id16 close-index="{{closeIndex.16}}" open-index="{{openIndex.16}}" button-type="treble"></accordion-button>
                <accordion-button button id17 close-index="{{closeIndex.17}}" open-index="{{openIndex.17}}" button-type="treble"></accordion-button>
                <accordion-button button id18 close-index="{{closeIndex.18}}" open-index="{{openIndex.18}}" button-type="treble"></accordion-button>
                <accordion-button button id19 close-index="{{closeIndex.19}}" open-index="{{openIndex.19}}" button-type="treble"></accordion-button>
                <accordion-button button id20 close-index="{{closeIndex.20}}" open-index="{{openIndex.20}}" button-type="treble"></accordion-button>
            </div>
            <div class$="col1 {{_computeColRotation(rotation)}}">
                <accordion-button button id0 close-index="{{closeIndex.0}}" open-index="{{openIndex.0}}" button-type="treble"></accordion-button>
                <accordion-button button id1 close-index="{{closeIndex.1}}" open-index="{{openIndex.1}}" button-type="treble"></accordion-button>
                <accordion-button button id2 close-index="{{closeIndex.2}}" open-index="{{openIndex.2}}" button-type="treble"></accordion-button>
                <accordion-button button id3 close-index="{{closeIndex.3}}" open-index="{{openIndex.3}}" button-type="treble"></accordion-button>
                <accordion-button button id4 close-index="{{closeIndex.4}}" open-index="{{openIndex.4}}" button-type="treble"></accordion-button>
                <accordion-button button id5 close-index="{{closeIndex.5}}" open-index="{{openIndex.5}}" button-type="treble"></accordion-button>
                <accordion-button button id6 close-index="{{closeIndex.6}}" open-index="{{openIndex.6}}" button-type="treble"></accordion-button>
                <accordion-button button id7 close-index="{{closeIndex.7}}" open-index="{{openIndex.7}}" button-type="treble"></accordion-button>
                <accordion-button button id8 close-index="{{closeIndex.8}}" open-index="{{openIndex.8}}" button-type="treble"></accordion-button>
                <accordion-button button id9 close-index="{{closeIndex.9}}" open-index="{{openIndex.9}}" button-type="treble"></accordion-button>
            </div>
        </local-dom>
    </template>
    <script>
        Polymer({
            is: "accordion-treble", observers: ['_swap(showingTreble)'], listeners: {},
            /* ./accordion-buttons-behavior.html
               ../ac-instrument-behaviors/instrument-buttons-behavior.html
            */
            behaviors: [
                InstrumentButtonsBehavior, AccordionButtonsBehavior, ScaleUpBehavior
            ],
            properties: {
                closeIndex: {
                    type: Array,
                    value: []
                },
                openIndex: {
                    type: Array,
                    value: []
                }
            },
            _loadNotes: function () {
                for (var i = 0; i < 31; i++) {
                    this.$$('AC-SYNTHESIZER')._loadNote(this.closeIndex[i]);
                    this.$$('AC-SYNTHESIZER')._loadNote(this.openIndex[i]);
                }
            },
            addButtonAction: function (e) {
                var note,
                    button = e.detail.midiNote - 24;
                var which = Math.floor(button / 2);
                e.detail.buttonState = 0;
                if (e.detail.cmd === 'note-on') {
                    e.detail.buttonState = (button % 2) + 1;
                    note = (button % 2)
                        ? this.openIndex[which]
                        : this.closeIndex[which];
                    this.$$('AC-SYNTHESIZER')._startButtonAudio(note, button, e);
                } else
                    this.$$('AC-SYNTHESIZER')._stopButtonAudio(button, e);
                this.$$("[id" + which + "]").addButtonAction(e);
            },
            addPitch: function (pitch) {
                for (var i = 0; i < 31; i++) {
                    this.closeIndex[i] = this.closeIndex[i] + pitch;
                    this.openIndex[i] = this.openIndex[i] + pitch;
                }
                this._loadNotes(); 
                this._updateIndexes();
            },
            _swap: function (showingTreble) {
                if (showingTreble) {
                    this.playAnimation('entry');
                }
            },
            ready: function () {
                this.closeIndex[21] = 61;
                this.closeIndex[22] = 55;
                this.closeIndex[23] = 59;
                this.closeIndex[24] = 62;
                this.closeIndex[25] = 67;
                this.closeIndex[26] = 71;
                this.closeIndex[27] = 74;
                this.closeIndex[28] = 79;
                this.closeIndex[29] = 83;
                this.closeIndex[30] = 86;
                this.closeIndex[10] = 66;
                this.closeIndex[11] = 55;
                this.closeIndex[12] = 60;
                this.closeIndex[13] = 64;
                this.closeIndex[14] = 67;
                this.closeIndex[15] = 72;
                this.closeIndex[16] = 76;
                this.closeIndex[17] = 79;
                this.closeIndex[18] = 84;
                this.closeIndex[19] = 88;
                this.closeIndex[20] = 91;
                this.closeIndex[0] = 75;
                this.closeIndex[1] = 60;
                this.closeIndex[2] = 65;
                this.closeIndex[3] = 69;
                this.closeIndex[4] = 72;
                this.closeIndex[5] = 77;
                this.closeIndex[6] = 81;
                this.closeIndex[7] = 84;
                this.closeIndex[8] = 89;
                this.closeIndex[9] = 93;
                this.openIndex[21] = 63;
                this.openIndex[22] = 57;
                this.openIndex[23] = 60;
                this.openIndex[24] = 64;
                this.openIndex[25] = 66;
                this.openIndex[26] = 69;
                this.openIndex[27] = 72;
                this.openIndex[28] = 76;
                this.openIndex[29] = 78;
                this.openIndex[30] = 81;
                this.openIndex[10] = 68;
                this.openIndex[11] = 59;
                this.openIndex[12] = 62;
                this.openIndex[13] = 65;
                this.openIndex[14] = 69;
                this.openIndex[15] = 71;
                this.openIndex[16] = 74;
                this.openIndex[17] = 77;
                this.openIndex[18] = 81;
                this.openIndex[19] = 83;
                this.openIndex[20] = 86;
                this.openIndex[0] = 73;
                this.openIndex[1] = 64;
                this.openIndex[2] = 67;
                this.openIndex[3] = 70;
                this.openIndex[4] = 74;
                this.openIndex[5] = 76;
                this.openIndex[6] = 79;
                this.openIndex[7] = 82;
                this.openIndex[8] = 86;
                this.openIndex[9] = 88;
                this.addPitch(this.tone);
                this._loadNotes();
            }
        });
    </script>
</dom-module>
