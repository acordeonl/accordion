<imports >
    <link rel="import" href="../polymer/polymer.html">
    <link rel="import" href="../ac-instrument-behaviors/instrument-buttons-behavior.html">
    <link rel="import" href="../local-dom/local-dom.html" async>
    <link rel="import" href="./accordion-button.html" async>
    <link rel="import" href="../ac-synthesizer/ac-synthesizer.html">
    <link rel="import" href="../iron-localstorage/iron-localstorage.html">
</imports>
<!--

Shows drop down menu (works on chrome)

### Usage
The list displayed in the drop down menu can be set as an attribute.

    <drop-menu list-items='["first" ,"second"]'></drop-menu>

For an overlayed drop menu:

    <drop-menu overlay-menu list-items='["first" ,"second"]'></drop-menu>

### Styling
 Custom property | Description | Default
----------------|-------------|----------
`--item-background-color` | List item backround color | `#f1ecef`
`--item-color` | List item color used for fonts | `#302f31`
`--button-close-color` | Icon button hover color | `4775D1`
`--button-background-color` | Drop menu's background color | `white`
`--button-close-color` | Icon button hover color | `4775D1`
`--icon-button` | Mixin applied the icon button | `{}`

@demo demo/drop-menu-demo.html
-->
<dom-module id="accordion-treble">
    <template>
        <style>
            :host {}
            local-dom {
                height: 100vh;
                @apply(--layout-center);
                @apply(--layout-justified);
            }
            .col1 {
                height: 82vh;
                margin:0 ;
                padding:0 ;
                /*@apply(--layout-vertical);*/
                @apply(--layout-justified);
            }
            .col2 {
                height: 92vh;
                padding: 0;
                /*margin-left: -0.3vh;
                margin-right: -0.3vh;*/
                /*@apply(--layout-vertical);*/
                @apply(--layout-justified);
            }
            [mobile] .col2 {
                padding: 0vw;
            }
            [tablet] .col2 {
                padding: 0vw;
            }
            .vertical {
                @apply(--layout-vertical);
            }
            .reversedVertical {
                @apply(--layout-vertical-reverse);
            }
            .reversedHorizontal {
                @apply(--layout-horizontal-reverse);
            }
            .horizontal {
                @apply(--layout-horizontal);
            }
        </style>
        <!-- local DOM -->
        <ac-synthesizer id="trebleSynthesizer" instrument-notes='62' instrument-url="/data/accordion_synth/treble"></ac-synthesizer>
        <local-dom class$="{{_computeRotation(rotation)}}" mobile="{{mobile}}" tablet="{{tablet}}" laptop="{{laptop}}">
            <div class$="col1 {{_computeColRotation(rotation)}}">
                <accordion-button button id21 close-note-index="[[buttonCloseNote.21]]" open-note-index="[[buttonOpenNote.21]]" button-type="treble"></accordion-button>
                <accordion-button button id22 close-note-index="[[buttonCloseNote.22]]" open-note-index="[[buttonOpenNote.22]]" button-type="treble"></accordion-button>
                <accordion-button button id23 close-note-index="[[buttonCloseNote.23]]" open-note-index="[[buttonOpenNote.23]]" button-type="treble"></accordion-button>
                <accordion-button button id24 close-note-index="[[buttonCloseNote.24]]" open-note-index="[[buttonOpenNote.24]]" button-type="treble"></accordion-button>
                <accordion-button button id25 close-note-index="[[buttonCloseNote.25]]" open-note-index="[[buttonOpenNote.25]]" button-type="treble"></accordion-button>
                <accordion-button button id26 close-note-index="[[buttonCloseNote.26]]" open-note-index="[[buttonOpenNote.26]]" button-type="treble"></accordion-button>
                <accordion-button button id27 close-note-index="[[buttonCloseNote.27]]" open-note-index="[[buttonOpenNote.27]]" button-type="treble"></accordion-button>
                <accordion-button button id28 close-note-index="[[buttonCloseNote.28]]" open-note-index="[[buttonOpenNote.28]]" button-type="treble"></accordion-button>
                <accordion-button button id29 close-note-index="[[buttonCloseNote.29]]" open-note-index="[[buttonOpenNote.29]]" button-type="treble"></accordion-button>
                <accordion-button button id30 close-note-index="[[buttonCloseNote.30]]" open-note-index="[[buttonOpenNote.30]]" button-type="treble"></accordion-button>
            </div>
            <div class$="col2 {{_computeColRotation(rotation)}}">
                <accordion-button button id10 close-note-index="{{buttonCloseNote.10}}" open-note-index="{{buttonOpenNote.10}}" button-type="treble"></accordion-button>
                <accordion-button button id11 close-note-index="{{buttonCloseNote.11}}" open-note-index="{{buttonOpenNote.11}}" button-type="treble"></accordion-button>
                <accordion-button button id12 close-note-index="{{buttonCloseNote.12}}" open-note-index="{{buttonOpenNote.12}}" button-type="treble"></accordion-button>
                <accordion-button button id13 close-note-index="{{buttonCloseNote.13}}" open-note-index="{{buttonOpenNote.13}}" button-type="treble"></accordion-button>
                <accordion-button button id14 close-note-index="{{buttonCloseNote.14}}" open-note-index="{{buttonOpenNote.14}}" button-type="treble"></accordion-button>
                <accordion-button button id15 close-note-index="{{buttonCloseNote.15}}" open-note-index="{{buttonOpenNote.15}}" button-type="treble"></accordion-button>
                <accordion-button button id16 close-note-index="{{buttonCloseNote.16}}" open-note-index="{{buttonOpenNote.16}}" button-type="treble"></accordion-button>
                <accordion-button button id17 close-note-index="{{buttonCloseNote.17}}" open-note-index="{{buttonOpenNote.17}}" button-type="treble"></accordion-button>
                <accordion-button button id18 close-note-index="{{buttonCloseNote.18}}" open-note-index="{{buttonOpenNote.18}}" button-type="treble"></accordion-button>
                <accordion-button button id19 close-note-index="{{buttonCloseNote.19}}" open-note-index="{{buttonOpenNote.19}}" button-type="treble"></accordion-button>
                <accordion-button button id20 close-note-index="{{buttonCloseNote.20}}" open-note-index="{{buttonOpenNote.20}}" button-type="treble"></accordion-button>
            </div>
            <div class$="col1 {{_computeColRotation(rotation)}}">
                <accordion-button button id0 close-note-index="{{buttonCloseNote.0}}" open-note-index="{{buttonOpenNote.0}}" button-type="treble"></accordion-button>
                <accordion-button button id1 close-note-index="{{buttonCloseNote.1}}" open-note-index="{{buttonOpenNote.1}}" button-type="treble"></accordion-button>
                <accordion-button button id2 close-note-index="{{buttonCloseNote.2}}" open-note-index="{{buttonOpenNote.2}}" button-type="treble"></accordion-button>
                <accordion-button button id3 close-note-index="{{buttonCloseNote.3}}" open-note-index="{{buttonOpenNote.3}}" button-type="treble"></accordion-button>
                <accordion-button button id4 close-note-index="{{buttonCloseNote.4}}" open-note-index="{{buttonOpenNote.4}}" button-type="treble"></accordion-button>
                <accordion-button button id5 close-note-index="{{buttonCloseNote.5}}" open-note-index="{{buttonOpenNote.5}}" button-type="treble"></accordion-button>
                <accordion-button button id6 close-note-index="{{buttonCloseNote.6}}" open-note-index="{{buttonOpenNote.6}}" button-type="treble"></accordion-button>
                <accordion-button button id7 close-note-index="{{buttonCloseNote.7}}" open-note-index="{{buttonOpenNote.7}}" button-type="treble"></accordion-button>
                <accordion-button button id8 close-note-index="{{buttonCloseNote.8}}" open-note-index="{{buttonOpenNote.8}}" button-type="treble"></accordion-button>
                <accordion-button button id9 close-note-index="{{buttonCloseNote.9}}" open-note-index="{{buttonOpenNote.9}}" button-type="treble"></accordion-button>
            </div>
        </local-dom>
    </template>
    <script>
        Polymer({
            is: "accordion-treble", observers: ['_swap(showingTreble)'], listeners: {},
            /* ./accordion-buttons-behavior.html
               ../ac-instrument-behaviors/instrument-buttons-behavior.html
            */
            behaviors: [
                InstrumentButtonsBehavior
            ],
            properties: {
                // Mapping of button to instrument button closing note
                buttonCloseNote: {
                    type: Array,
                    value: []
                },
                // Mapping of button to instrument button opening note with
                buttonOpenNote: {
                    type: Array,
                    value: []
                }
            },
            _loadNotes: function () {
                // this.async(function(){
                var i ;
                    for ( i = 0; i < 31; i++) {
                        this._loadNote('trebleSynthesizer',this.buttonCloseNote[i]);
                    }
                // } ,  0 )  ;
                // this.async(function(){
                    for (i = 0; i < 31; i++) {
                        this._loadNote('trebleSynthesizer', this.buttonOpenNote[i]);
                    }
                // } , 0 )  ;
            },
            _setPitch: function (diff) {
                for (var i = 0; i < 31; i++) {
                    this.buttonCloseNote[i] = this.buttonCloseNote[i] + diff;
                    this.buttonOpenNote[i] = this.buttonOpenNote[i] + diff;
                }
                this._updateNotesArray();
            },
            addButtonAction: function (e) {
                var note,
                    button = e.detail.midiNote - 24;
                var which = Math.floor(button / 2);
                e.detail.buttonState = 0;
                if (e.detail.cmd === 'note-on') {
                    e.detail.buttonState = (button % 2) + 1;
                    note = this.buttonCloseNote[which] ;
                    if(button%2)
                        note = this.buttonOpenNote[which] ;
                    this.$$('AC-SYNTHESIZER')._startButtonAudio(note, button, e);
                } else
                    this.$$('AC-SYNTHESIZER')._stopButtonAudio(button, e);
                this.$$("[id" + which + "]").addButtonAction(e);
            },
            _updateNotesArray: function(){
                var array = this.buttonCloseNote;
                this.buttonCloseNote = [];
                this.buttonCloseNote = array;
                array = this.buttonOpenNote;
                this.buttonOpenNote = [];
                this.buttonOpenNote = array;
            },
            _swap: function (showingTreble) {
                if (showingTreble) {
                    this.playAnimation('entry');
                }
            },
            ready: function () {
                if(true){
                    this.buttonCloseNote[21] = 61;
                    this.buttonCloseNote[22] = 55;
                    this.buttonCloseNote[23] = 59;
                    this.buttonCloseNote[24] = 62;
                    this.buttonCloseNote[25] = 67;
                    this.buttonCloseNote[26] = 71;
                    this.buttonCloseNote[27] = 74;
                    this.buttonCloseNote[28] = 79;
                    this.buttonCloseNote[29] = 83;
                    this.buttonCloseNote[30] = 86;
                    this.buttonCloseNote[10] = 66;
                    this.buttonCloseNote[11] = 55;
                    this.buttonCloseNote[12] = 60;
                    this.buttonCloseNote[13] = 64;
                    this.buttonCloseNote[14] = 67;
                    this.buttonCloseNote[15] = 72;
                    this.buttonCloseNote[16] = 76;
                    this.buttonCloseNote[17] = 79;
                    this.buttonCloseNote[18] = 84;
                    this.buttonCloseNote[19] = 88;
                    this.buttonCloseNote[20] = 91;
                    this.buttonCloseNote[0] = 75;
                    this.buttonCloseNote[1] = 60;
                    this.buttonCloseNote[2] = 65;
                    this.buttonCloseNote[3] = 69;
                    this.buttonCloseNote[4] = 72;
                    this.buttonCloseNote[5] = 77;
                    this.buttonCloseNote[6] = 81;
                    this.buttonCloseNote[7] = 84;
                    this.buttonCloseNote[8] = 89;
                    this.buttonCloseNote[9] = 93;
                    this.buttonOpenNote[21] = 63;
                    this.buttonOpenNote[22] = 57;
                    this.buttonOpenNote[23] = 60;
                    this.buttonOpenNote[24] = 64;
                    this.buttonOpenNote[25] = 66;
                    this.buttonOpenNote[26] = 69;
                    this.buttonOpenNote[27] = 72;
                    this.buttonOpenNote[28] = 76;
                    this.buttonOpenNote[29] = 78;
                    this.buttonOpenNote[30] = 81;
                    this.buttonOpenNote[10] = 68;
                    this.buttonOpenNote[11] = 59;
                    this.buttonOpenNote[12] = 62;
                    this.buttonOpenNote[13] = 65;
                    this.buttonOpenNote[14] = 69;
                    this.buttonOpenNote[15] = 71;
                    this.buttonOpenNote[16] = 74;
                    this.buttonOpenNote[17] = 77;
                    this.buttonOpenNote[18] = 81;
                    this.buttonOpenNote[19] = 83;
                    this.buttonOpenNote[20] = 86;
                    this.buttonOpenNote[0] = 73;
                    this.buttonOpenNote[1] = 64;
                    this.buttonOpenNote[2] = 67;
                    this.buttonOpenNote[3] = 70;
                    this.buttonOpenNote[4] = 74;
                    this.buttonOpenNote[5] = 76;
                    this.buttonOpenNote[6] = 79;
                    this.buttonOpenNote[7] = 82;
                    this.buttonOpenNote[8] = 86;
                    this.buttonOpenNote[9] = 88;
                    this._updateNotesArray();
                }
                this.addPitch(0) ;
            }
        });
    </script>
</dom-module>
