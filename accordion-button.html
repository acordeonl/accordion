<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-image/iron-image.html">
<!--

Shows drop down menu (works on chrome)

### Usage
The list displayed in the drop down menu can be set as an attribute.

    <drop-menu list-items='["first" ,"second"]'></drop-menu>

For an overlayed drop menu:

    <drop-menu overlay-menu list-items='["first" ,"second"]'></drop-menu>

### Styling
 Custom property | Description | Default
----------------|-------------|----------
`--item-background-color` | List item backround color | `#f1ecef`
`--item-color` | List item color used for fonts | `#302f31`
`--close-color` | Icon button hover color | `4775D1`
`--content-background` | Drop menu's background color | `white`
`--close-color` | Icon button hover color | `4775D1`
`--icon-button` | Mixin applied the icon button | `{}`

@demo demo/drop-menu-demo.html
-->
<dom-module id="accordion-button">
    <template>
        <style>
            :host {}
            .bass {
                margin-top: -0.6vh;
                user-select: none;
                height: 5.4vh;
                width: 5.4vh;
            }
            .treble {
                user-select: none;
                margin-top: -0.6vh;
                height: 6.8vh;
                width: 6.8vh;
            }
            [box] {
                /*@apply(--layout-center-justified);
                @apply(--layout-vertical);
                @apply(--layout-center);*/
                background-color: var(--content-background);
                border-radius: 100%;
            }
            [shadow] {
                @apply(--layout-center-justified);
                @apply(--layout-vertical);
                @apply(--layout-center);
                background-color: #e4e4e4;
                /*background-color: #f1ecef ;*/
                border-radius: 100%;
            }
            .treble[shadow]{
                height:8vh;
                width:8vh;
            }
            .bass[shadow] {
                height:6.5vh;
                width:6.5vh;
            }
        </style>
        <!-- local DOM -->
        <div shadow class$="{{buttonType}}">
            <div box class$="{{buttonType}}" style$="background-color:{{_computeColor(state)}} ;">
            </div>
        </div>
    </template>
    <script>
        Polymer({
            is: "accordion-button",
            observers: [],
            behaviors: [],
            listeners: {},
            properties: {
                text: {
                    type: String,
                    value: ""
                },
                state: {
                    type: Number
                },
                previousState: {
                    type: Number
                },
                buttonType: {
                    type: String
                },
                closeIndex: {
                    type: Number
                },
                openIndex: {
                    type: Number
                },
                source: {
                    type: Object
                },
                sourceGain: {
                    type: Object
                }
            },
            _playNote: function (state, note) {
                if (state !== this.previousState) {
                    this._stopSource();
                    this.source = context.createBufferSource();
                    if (this.buttonType === 'treble') {
                        this.source.buffer = buffers[note + pitch];
                        this.source.loopStart = buffers[note + pitch].duration - bufferLoopLengths[note + pitch];
                        this.source.loopEnd = buffers[note + pitch].duration;
                    } else {
                        this.source.buffer = buffers[note];
                        this.source.loopStart = buffers[note].duration - bufferLoopLengths[note];
                        this.source.loopEnd = buffers[note].duration;
                    }
                    this.sourceGain = context.createGain();
                    this.source.connect(this.sourceGain);
                    this.source.loop = true;
                    this.sourceGain.connect(compressor);
                    this.source.start(0);
                }
            },
            _stopSource: function () {
                if (this.source !== undefined) {
                    this.sourceGain.gain.value = 0;
                    this.source.stop(context.currentTime + 0.01);
                }
            },
            _computeColor: function (state) {
                switch (state) {
                    case 0:
                        this._stopSource();
                        this.previousState = state;
                        return 'white';
                    case 1:
                        this._playNote(state, this.closeIndex);
                        this.previousState = state;
                        return '#4775D1';
                    case 2:
                        this._playNote(state, this.openIndex);
                        this.previousState = state;
                        return '#CC6666';
                }
            },
            ready: function () {
                Polymer.RenderStatus.afterNextRender(this, function () {
                    if (!this.state) {
                        this.state = 0;
                    }
                });
            }
        });
    </script>
</dom-module>
